#ifdef _DEBUG
#define _CRTDBG_MAP_ALLOC
#include <crtdbg.h>
#define DEBUG_NEW new(_CLIENT_BLOCK, __FILE__, __LINE__)
#define new DEBUG_NEW
#endif

#include <SFML/Graphics.hpp>
#include "Engine.h"
#include "Interface.h"
#include "Select.h"
#include "Globals.h"

#include <stdlib.h>
 
int main()
{

	//print some stuff to terminal
	printf("Blastorium:Recoded v1.2.2 Beta (Debugging version)\n");
	
	printf("WASD for Player 1 to move, Arrow keys for player 2\n");
	printf("For player 1, press E to use weapon/select, and Q to change weapon/cancel select\n");
	printf("For player 2, press Right Shift to use weapon/select, and Right Ctrl to change weapon/cancel select\n"); 
	printf("Press tilde (~) for screenshot\n"); 
	printf("Press escape or the close button to exit\n\n"); 
	
	printf("For possible further updates, check vot1bear.blogspot.com\n");
	printf("(c) 2013 Vot1_Bear\n"); 
	
	shared_ptr<sf::RenderWindow> MainWindow(nullptr);
	shared_ptr<GlobalManager>	 MainGlobalManager(nullptr);
	shared_ptr<SelectManager>    MainSelect(nullptr);
	shared_ptr<Engine>			 MainEngine(nullptr);
	pair < int, vector<int> >	 Sel;						//contains the result of SelectScreen()

	//initialize classes
	MainWindow = make_shared<sf::RenderWindow> (sf::VideoMode(864,480),"Blastorium:Recoded");
	MainWindow -> setFramerateLimit(30); 

	MainGlobalManager = make_shared<GlobalManager>(MainWindow);

	MainSelect = make_shared<SelectManager>();
	MainSelect -> InitSelect();

	MainEngine = make_shared<Engine> (MainGlobalManager);              

	//GUI loop 
	while(MainWindow->isOpen()){
		int now=MainMenu(MainWindow);								//receive input from main menu
		if (now==0||!MainWindow->isOpen()) {						//break if game closed 
			break;
		}
		else if (now==3){											//play game, go to select screen 
			Sel=MainSelect->SelectScreen(MainWindow);				//receive input from select screen 
			if (Sel.first==0) break;								//break if game closed
			if (Sel.first==-1) continue;							//cancel select, back to main menu                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
			MainEngine->Go(Sel.first-1,Sel.second);					//else go to game 
		} else {
			//help screen, WIP
		} 
	} 
    _CrtSetDbgFlag ( _CRTDBG_ALLOC_MEM_DF | _CRTDBG_LEAK_CHECK_DF );
	return(0);
}